Option Explicit

'--------------------------------------------
' Module: Déplacement et restauration Colonne D
' Description:
'   - MoveData: copie et déplace le contenu de D7:D(lastRow) vers X7:X
'     en créant une feuille de sauvegarde nommée "Backup_D".
'   - RestoreData: restaure les données de "Backup_D" vers D7:D(lastRow).
'--------------------------------------------

Const BackupSheetName As String = "Backup_D"

Sub MoveData()
    Dim ws As Worksheet
    Dim backupWs As Worksheet
    Dim lastRow As Long
    
    Set ws = ActiveSheet
    lastRow = ws.Cells(ws.Rows.Count, "D").End(xlUp).Row
    
    ' Créer ou nettoyer la feuille de sauvegarde
    On Error Resume Next
    Set backupWs = ThisWorkbook.Worksheets(BackupSheetName)
    On Error GoTo 0
    If backupWs Is Nothing Then
        Set backupWs = ThisWorkbook.Worksheets.Add(After:=ThisWorkbook.Sheets(ThisWorkbook.Sheets.Count))
        backupWs.Name = BackupSheetName
    Else
        backupWs.Cells.Clear
    End If
    
    ' Copier les données de D7:D(lastRow) dans Backup_D
    ws.Range("D7:D" & lastRow).Copy Destination:=backupWs.Range("A1")
    
    ' Déplacer (couper-coller) vers X7
    ws.Range("D7:D" & lastRow).Cut Destination:=ws.Range("X7")
    
    MsgBox "Données déplacées vers X7 et sauvegardées dans la feuille '" & BackupSheetName & "'.", vbInformation
End Sub

Sub RestoreData()
    Dim ws As Worksheet
    Dim backupWs As Worksheet
    Dim lastBackupRow As Long
    
    On Error Resume Next
    Set backupWs = ThisWorkbook.Worksheets(BackupSheetName)
    On Error GoTo 0
    If backupWs Is Nothing Then
        MsgBox "Feuille de sauvegarde '" & BackupSheetName & "' introuvable.", vbExclamation
        Exit Sub
    End If
    
    Set ws = ActiveSheet
    lastBackupRow = backupWs.Cells(backupWs.Rows.Count, "A").End(xlUp).Row
    
    ' Restaurer dans D7:D(lastBackupRow+6)
    ws.Range("D7:D" & lastBackupRow + 6).ClearContents
    backupWs.Range("A1:A" & lastBackupRow).Copy Destination:=ws.Range("D7")
    
    ' Optionnel: nettoyer la feuille de sauvegarde
    backupWs.Cells.Clear
    
    MsgBox "Données restaurées de la feuille '" & BackupSheetName & "'.", vbInformation
End Sub
